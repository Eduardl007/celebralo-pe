<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="google-site-verification" content="-WivQeeMjDJ48477slxQm1V3g5Z4kxukvV6vjRAfXcc" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Servicio | Cel√©bralo pe</title>
    <meta name="description" content="Detalle del servicio para eventos en Sullana, Piura.">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../assets/favicon.svg">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <!-- Styles -->
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/responsive.css">

    <style>
        .service-hero {
            padding-top: calc(var(--header-height) + var(--spacing-6));
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--white) 100%);
        }

        .service-grid {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: var(--spacing-8);
            padding: var(--spacing-6) 0;
        }

        @media (max-width: 1024px) {
            .service-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Gallery Grid */
        .gallery-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--spacing-3);
            max-height: 400px;
            margin-bottom: var(--spacing-6);
        }

        .gallery-main {
            position: relative;
            border-radius: var(--radius-xl);
            overflow: hidden;
            cursor: pointer;
        }

        .gallery-main img,
        .gallery-main .placeholder {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-main .placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 6rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .gallery-side {
            display: grid;
            grid-template-rows: 1fr 1fr;
            gap: var(--spacing-3);
        }

        .gallery-thumb {
            position: relative;
            border-radius: var(--radius-lg);
            overflow: hidden;
            cursor: pointer;
        }

        .gallery-thumb img,
        .gallery-thumb .placeholder {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .gallery-thumb .placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
        }

        .gallery-more {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
        }

        @media (max-width: 768px) {
            .gallery-grid {
                grid-template-columns: 1fr;
                max-height: none;
            }

            .gallery-main {
                height: 250px;
            }

            .gallery-side {
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto;
                height: 120px;
            }
        }

        .service-badges {
            position: absolute;
            top: var(--spacing-4);
            left: var(--spacing-4);
            display: flex;
            gap: var(--spacing-2);
            flex-wrap: wrap;
        }

        .service-badge {
            padding: var(--spacing-1) var(--spacing-3);
            background: var(--white);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
            box-shadow: var(--shadow-md);
        }

        .service-badge.verified {
            background: var(--success);
            color: var(--white);
        }

        .service-info h1 {
            font-size: var(--font-size-2xl);
            margin-bottom: var(--spacing-2);
        }

        .service-category {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-2);
            padding: var(--spacing-1) var(--spacing-3);
            background: var(--primary-50);
            color: var(--primary);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
            margin-bottom: var(--spacing-4);
        }

        .service-rating {
            display: flex;
            align-items: center;
            gap: var(--spacing-2);
            margin-bottom: var(--spacing-4);
        }

        .service-rating .stars {
            color: var(--warning);
        }

        .service-rating .score {
            font-weight: var(--font-weight-bold);
        }

        .service-rating .reviews {
            color: var(--text-secondary);
        }

        .service-description {
            color: var(--text-secondary);
            line-height: 1.7;
            margin-bottom: var(--spacing-6);
        }

        /* Booking Card */
        .booking-card {
            position: sticky;
            top: calc(var(--header-height) + var(--spacing-4));
            background: var(--white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            padding: var(--spacing-6);
        }

        .booking-price {
            display: flex;
            align-items: baseline;
            gap: var(--spacing-2);
            margin-bottom: var(--spacing-4);
            padding-bottom: var(--spacing-4);
            border-bottom: 1px solid var(--border-light);
        }

        .booking-price .amount {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            color: var(--primary);
        }

        .booking-price .unit {
            color: var(--text-secondary);
        }

        .booking-actions {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-3);
        }

        .booking-actions .btn {
            width: 100%;
            justify-content: center;
        }

        .owner-card {
            display: flex;
            align-items: center;
            gap: var(--spacing-3);
            padding: var(--spacing-4);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            margin-top: var(--spacing-4);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .owner-card:hover {
            background: var(--gray-100);
        }

        .owner-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: var(--font-weight-bold);
        }

        .owner-info {
            flex: 1;
        }

        .owner-info strong {
            display: block;
            margin-bottom: 2px;
        }

        .owner-info span {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        .owner-response {
            text-align: right;
        }

        .owner-response .rate {
            font-weight: var(--font-weight-bold);
            color: var(--success);
        }

        .owner-response .time {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }

        /* Sections */
        .service-section {
            padding: var(--spacing-8) 0;
            border-top: 1px solid var(--border-light);
        }

        .service-section h2 {
            font-size: var(--font-size-xl);
            margin-bottom: var(--spacing-4);
        }

        /* Packages */
        .packages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-4);
        }

        .package-card {
            background: var(--white);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: var(--spacing-5);
            transition: all var(--transition-fast);
        }

        .package-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .package-card.recommended {
            border-color: var(--primary);
            position: relative;
        }

        .package-card.recommended::before {
            content: 'Recomendado';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: var(--white);
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-semibold);
        }

        .package-name {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--spacing-2);
        }

        .package-price {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            color: var(--primary);
            margin-bottom: var(--spacing-3);
        }

        .package-description {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            line-height: 1.6;
        }

        /* Features */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-4);
        }

        .feature-item {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-3);
        }

        .feature-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-lg);
            background: var(--primary-50);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .feature-text {
            font-size: var(--font-size-sm);
        }

        /* Coverage */
        .coverage-list {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-2);
        }

        .coverage-tag {
            padding: var(--spacing-2) var(--spacing-3);
            background: var(--gray-100);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
        }

        /* Contact Modal */
        .contact-modal {
            max-width: 500px;
        }

        .contact-modal h2 {
            margin-bottom: var(--spacing-4);
        }

        .contact-form .form-group {
            margin-bottom: var(--spacing-4);
        }

        .contact-form label {
            display: block;
            margin-bottom: var(--spacing-2);
            font-weight: var(--font-weight-medium);
        }

        .contact-form input,
        .contact-form select,
        .contact-form textarea {
            width: 100%;
            padding: var(--spacing-3);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
        }

        .contact-form textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Availability Grid */
        .availability-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .availability-day {
            text-align: center;
            padding: 12px 8px;
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            transition: all var(--transition-fast);
        }

        .availability-day.available {
            background: var(--success-50);
            border: 1px solid var(--success-100);
        }

        .availability-day.unavailable {
            background: var(--gray-100);
            opacity: 0.6;
        }

        .availability-day .day-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .availability-day .day-hours {
            font-size: 11px;
            color: var(--text-muted);
        }

        .availability-day.available .day-hours {
            color: var(--success);
        }

        /* Policies */
        .policies-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .policy-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            background: var(--gray-50);
            border-radius: var(--radius-lg);
        }

        .policy-item i {
            color: var(--primary);
            font-size: 20px;
            margin-top: 2px;
        }

        .policy-item strong {
            display: block;
            margin-bottom: 4px;
        }

        .policy-item p {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0;
        }

        .policy-rules {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .policy-rules .rule {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: var(--white);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-full);
            font-size: 13px;
        }

        .policy-rules .rule i {
            color: var(--primary);
            font-size: 12px;
        }

        /* Reviews */
        .reviews-summary {
            margin-bottom: 24px;
        }

        .reviews-score {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .score-number {
            font-size: 48px;
            font-weight: 800;
            color: var(--text-primary);
        }

        .score-stars {
            color: var(--warning);
            font-size: 20px;
        }

        .score-count {
            color: var(--text-secondary);
        }

        .reviews-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .review-card {
            padding: 20px;
            background: var(--gray-50);
            border-radius: var(--radius-xl);
        }

        .review-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .review-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .review-info {
            flex: 1;
        }

        .review-info strong {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .review-info .verified-badge {
            font-size: 12px;
            color: var(--success);
        }

        .review-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            color: var(--text-muted);
        }

        .review-stars {
            color: var(--warning);
        }

        .review-text {
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .review-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-light);
        }

        .review-event {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--text-muted);
        }

        .review-helpful {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 13px;
            color: var(--text-muted);
        }

        .reviews-empty {
            text-align: center;
            padding: 40px;
            color: var(--text-muted);
        }

        .reviews-empty i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        /* Booking Calendar */
        .booking-calendar {
            margin-bottom: 16px;
        }

        .booking-selection {
            background: var(--success-50);
            border: 1px solid var(--success);
            border-radius: var(--radius-lg);
            padding: 12px 16px;
            margin-bottom: 16px;
        }

        .selection-item {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--success);
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .availability-grid {
                grid-template-columns: repeat(4, 1fr);
            }

            .reviews-score {
                flex-wrap: wrap;
            }

            .score-number {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header" id="header">
        <div class="container">
            <nav class="nav">
                <a href="../index.html" class="logo">
                    <span class="logo-icon">üéâ</span>
                    <span class="logo-text">Cel√©bralo<span class="logo-accent">pe</span></span>
                </a>

                <div class="nav-menu" id="navMenu">
                    <a href="locales.html" class="nav-link">Locales</a>
                    <a href="servicios.html" class="nav-link active">Servicios</a>
                    <!-- OCULTO: <a href="paquetes.html" class="nav-link">Paquetes</a> -->
                    <a href="cotizador.html" class="nav-link">Cotizador</a>
                </div>

                <div class="nav-actions">
                    <button class="btn btn-primary btn-sm" onclick="openContactModal()">
                        Cotizar Servicio
                    </button>
                    <button class="nav-toggle" id="navToggle" aria-label="Menu">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <section class="service-hero">
            <div class="container">
                <div class="service-grid">
                    <!-- Gallery -->
                    <div class="service-main">
                        <div class="gallery-grid" id="serviceGallery">
                            <!-- Gallery loaded via JS -->
                        </div>

                        <div class="service-info" style="margin-top: var(--spacing-6);">
                            <div class="service-category" id="serviceCategory">
                                <span class="emoji"></span>
                                <span class="name"></span>
                            </div>
                            <h1 id="serviceName">Cargando...</h1>
                            <div class="service-rating" id="serviceRating">
                                <span class="stars"><i class="fas fa-star"></i></span>
                                <span class="score"></span>
                                <span class="reviews"></span>
                            </div>
                            <p class="service-description" id="serviceDescription"></p>
                        </div>

                        <!-- Features Section -->
                        <div class="service-section">
                            <h2><i class="fas fa-check-circle" style="color: var(--success); margin-right: 8px;"></i>Incluye</h2>
                            <div class="features-grid" id="featuresGrid"></div>
                        </div>

                        <!-- Packages Section -->
                        <div class="service-section">
                            <h2><i class="fas fa-box" style="color: var(--primary); margin-right: 8px;"></i>Paquetes Disponibles</h2>
                            <div class="packages-grid" id="packagesGrid"></div>
                        </div>

                        <!-- Coverage Section -->
                        <div class="service-section">
                            <h2><i class="fas fa-map-marker-alt" style="color: var(--secondary); margin-right: 8px;"></i>Cobertura</h2>
                            <div class="coverage-list" id="coverageList"></div>
                        </div>

                        <!-- Availability Section -->
                        <div class="service-section">
                            <h2><i class="fas fa-clock" style="color: var(--info); margin-right: 8px;"></i>Disponibilidad</h2>
                            <div class="availability-grid" id="availabilityGrid"></div>
                            <p style="margin-top: 16px; font-size: 14px; color: var(--text-muted);">
                                <i class="fas fa-info-circle"></i> Reserva con minimo <span id="advanceBooking">-</span> de anticipacion
                            </p>
                        </div>

                        <!-- Policies Section -->
                        <div class="service-section" id="policiesSection">
                            <h2><i class="fas fa-file-contract" style="color: var(--warning); margin-right: 8px;"></i>Politicas</h2>
                            <div class="policies-list">
                                <div class="policy-item" id="policyCancellation">
                                    <i class="fas fa-calendar-times"></i>
                                    <div>
                                        <strong>Cancelacion</strong>
                                        <p></p>
                                    </div>
                                </div>
                                <div class="policy-item" id="policyDeposit">
                                    <i class="fas fa-hand-holding-usd"></i>
                                    <div>
                                        <strong>Deposito</strong>
                                        <p></p>
                                    </div>
                                </div>
                                <div class="policy-rules" id="policyRules"></div>
                            </div>
                        </div>

                        <!-- Reviews Section -->
                        <div class="service-section">
                            <h2><i class="fas fa-star" style="color: var(--warning); margin-right: 8px;"></i>Resenas</h2>
                            <div class="reviews-summary" id="reviewsSummary">
                                <div class="reviews-score">
                                    <span class="score-number" id="avgRating">4.9</span>
                                    <div class="score-stars" id="scoreStars"></div>
                                    <span class="score-count" id="totalReviews">0 resenas</span>
                                </div>
                            </div>

                            <!-- Boton para escribir resena -->
                            <div style="background: linear-gradient(135deg, var(--primary-50) 0%, var(--secondary-50) 100%); border: 2px dashed var(--primary); border-radius: 12px; padding: 20px; margin: 20px 0; text-align: center;">
                                <h4 style="margin-bottom: 8px; color: var(--primary);">¬øYa contrataste este servicio?</h4>
                                <p style="color: var(--text-secondary); margin-bottom: 16px;">Comparte tu experiencia y ayuda a otros</p>
                                <button class="btn btn-primary" onclick="openReviewModal()">
                                    <i class="fas fa-pen"></i> Escribir Resena
                                </button>
                            </div>

                            <div class="reviews-list" id="reviewsList"></div>
                            <div class="reviews-empty" id="reviewsEmpty" style="display: none;">
                                <i class="fas fa-comments"></i>
                                <p>Aun no hay resenas para este servicio.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Booking Card -->
                    <div class="service-sidebar">
                        <div class="booking-card">
                            <div class="booking-price">
                                <span class="amount" id="bookingPrice">S/ --</span>
                                <span class="unit" id="bookingUnit">/servicio</span>
                            </div>

                            <!-- Calendar -->
                            <div class="booking-calendar" id="bookingCalendar"></div>

                            <div class="booking-selection" id="bookingSelection" style="display: none;">
                                <div class="selection-item">
                                    <i class="fas fa-calendar-check"></i>
                                    <span id="selectedDateText">Selecciona una fecha</span>
                                </div>
                            </div>

                            <div class="booking-actions">
                                <button class="btn btn-primary btn-lg" id="btnReservar" onclick="openContactModal()" disabled>
                                    <i class="fas fa-calendar-check"></i> Reservar Ahora
                                </button>
                                <button class="btn btn-outline btn-lg" onclick="contactOwner()">
                                    <i class="fas fa-comments"></i> Contactar Proveedor
                                </button>
                            </div>

                            <div class="owner-card" id="ownerCard" onclick="contactOwner()">
                                <div class="owner-avatar" id="ownerAvatar">--</div>
                                <div class="owner-info">
                                    <strong id="ownerName">Proveedor</strong>
                                    <span id="ownerBusiness">Servicio</span>
                                </div>
                                <div class="owner-response">
                                    <div class="rate" id="ownerRate">--%</div>
                                    <div class="time" id="ownerTime">respuesta</div>
                                </div>
                            </div>

                            <div style="margin-top: var(--spacing-4); padding-top: var(--spacing-4); border-top: 1px solid var(--border-light);">
                                <div style="display: flex; align-items: center; gap: var(--spacing-2); color: var(--text-secondary); font-size: var(--font-size-sm);">
                                    <i class="fas fa-shield-alt" style="color: var(--success);"></i>
                                    <span>Pago seguro a traves de la plataforma</span>
                                </div>
                            </div>

                            <!-- Acciones: Compartir y Favoritos -->
                            <div class="share-actions" style="display: flex; justify-content: center; gap: var(--spacing-4); margin-top: var(--spacing-4); padding-top: var(--spacing-4); border-top: 1px solid var(--border-light);">
                                <button onclick="shareService()" title="Compartir" style="padding: var(--spacing-2); color: var(--text-muted); cursor: pointer; transition: color 0.2s; background: none; border: none;">
                                    <i class="fas fa-share-alt"></i>
                                </button>
                                <button onclick="toggleFavoriteService()" title="Guardar" id="favBtn" style="padding: var(--spacing-2); color: var(--text-muted); cursor: pointer; transition: color 0.2s; background: none; border: none;">
                                    <i class="far fa-heart"></i>
                                </button>
                                <button onclick="window.print()" title="Imprimir" style="padding: var(--spacing-2); color: var(--text-muted); cursor: pointer; transition: color 0.2s; background: none; border: none;">
                                    <i class="fas fa-print"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Contact Modal -->
    <div class="modal" id="contactModal">
        <div class="modal-content contact-modal">
            <button class="modal-close" onclick="closeContactModal()">
                <i class="fas fa-times"></i>
            </button>
            <h2>Solicitar Cotizaci√≥n</h2>
            <p style="color: var(--text-secondary); margin-bottom: var(--spacing-4);">
                Completa el formulario y te contactaremos pronto.
            </p>
            <form class="contact-form" id="contactForm" onsubmit="submitContact(event)">
                <div class="form-group">
                    <label for="contactName">Nombre completo *</label>
                    <input type="text" id="contactName" required>
                </div>
                <div class="form-group">
                    <label for="contactPhone">Tel√©fono *</label>
                    <input type="tel" id="contactPhone" required>
                </div>
                <div class="form-group">
                    <label for="contactEmail">Email</label>
                    <input type="email" id="contactEmail">
                </div>
                <div class="form-group">
                    <label for="contactEvent">Tipo de evento *</label>
                    <select id="contactEvent" required>
                        <option value="">Seleccionar tipo de evento...</option>
                        <option value="matrimonio">üíí Matrimonio</option>
                        <option value="quinceanos">üëë Fiesta de XV A√±os</option>
                        <option value="cumpleanos">üéÇ Cumplea√±os</option>
                        <option value="corporativo">üè¢ Evento Corporativo</option>
                        <option value="bautizo">üë∂ Bautizo</option>
                        <option value="graduacion">üéì Graduaci√≥n</option>
                        <option value="baby-shower">üçº Baby Shower</option>
                        <option value="aniversario">üíë Aniversario</option>
                        <option value="otro">üéâ Otro evento</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="contactDate">Fecha del evento</label>
                    <input type="date" id="contactDate">
                </div>
                <div class="form-group">
                    <label for="contactMessage">Mensaje adicional</label>
                    <textarea id="contactMessage" placeholder="Cu√©ntanos m√°s sobre tu evento..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
                    Enviar Solicitud
                </button>
            </form>
        </div>
    </div>

    <!-- Modal para escribir resena -->
    <div class="modal" id="reviewModal">
        <div class="modal-overlay" onclick="closeReviewModal()"></div>
        <div class="modal-content contact-modal" style="max-width: 500px; max-height: 90vh; overflow-y: auto;">
            <button class="modal-close" onclick="closeReviewModal()">
                <i class="fas fa-times"></i>
            </button>
            <h2 style="display: flex; align-items: center; gap: 8px;">
                <i class="fas fa-star" style="color: var(--warning);"></i>
                Escribe tu resena
            </h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;" id="reviewModalSubtitle">
                Comparte tu experiencia con este servicio
            </p>
            <form id="reviewForm" onsubmit="submitReview(event)">
                <div class="form-group" style="text-align: center;">
                    <label style="display: block; margin-bottom: 12px;">¬øComo calificarias tu experiencia?</label>
                    <div class="star-rating-input" id="starRatingInput" style="display: flex; gap: 8px; justify-content: center; margin-bottom: 16px;">
                        <i class="far fa-star" data-rating="1" style="font-size: 2rem; color: var(--gray-300); cursor: pointer;"></i>
                        <i class="far fa-star" data-rating="2" style="font-size: 2rem; color: var(--gray-300); cursor: pointer;"></i>
                        <i class="far fa-star" data-rating="3" style="font-size: 2rem; color: var(--gray-300); cursor: pointer;"></i>
                        <i class="far fa-star" data-rating="4" style="font-size: 2rem; color: var(--gray-300); cursor: pointer;"></i>
                        <i class="far fa-star" data-rating="5" style="font-size: 2rem; color: var(--gray-300); cursor: pointer;"></i>
                    </div>
                    <input type="hidden" id="reviewRating" value="0">
                </div>
                <div class="form-group">
                    <label for="reviewEventType">¬øPara que tipo de evento contrataste?</label>
                    <select id="reviewEventType" required>
                        <option value="">Selecciona...</option>
                        <option value="Matrimonio">Matrimonio</option>
                        <option value="Quinceanos">XV Anos</option>
                        <option value="Cumpleanos">Cumpleanos</option>
                        <option value="Bautizo">Bautizo</option>
                        <option value="Corporativo">Evento Corporativo</option>
                        <option value="Graduacion">Graduacion</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="reviewComment">Cuentanos tu experiencia</label>
                    <textarea id="reviewComment" placeholder="¬øQue te gusto del servicio? ¬øComo fue la atencion? ¬øLo recomendarias?" required></textarea>
                </div>
                <div class="form-group">
                    <label for="reviewName">Tu nombre</label>
                    <input type="text" id="reviewName" placeholder="Tu nombre" required>
                </div>
                <div class="form-group">
                    <label for="reviewEmail">Correo (no se publicara)</label>
                    <input type="email" id="reviewEmail" placeholder="tu@correo.com" required>
                </div>
                <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;" id="submitReviewBtn">
                    <i class="fas fa-paper-plane"></i> Publicar Resena
                </button>
                <p style="text-align: center; margin-top: 12px; font-size: 13px; color: var(--gray-500);">
                    <i class="fas fa-shield-alt"></i> Tu resena sera revisada antes de publicarse
                </p>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2025 Cel√©bralo pe. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Chatbot -->
    <div class="chatbot" id="chatbot">
        <button class="chatbot-trigger" id="chatbotTrigger">
            <i class="fas fa-comments"></i>
            <span class="chatbot-badge">1</span>
        </button>
        <div class="chatbot-window" id="chatbotWindow">
            <div class="chatbot-header">
                <div class="chatbot-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="chatbot-info">
                    <strong>Cel√©</strong>
                    <span>Tu asistente festivo</span>
                </div>
                <button class="chatbot-close" id="chatbotClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="chatbot-messages" id="chatbotMessages"></div>
            <div class="chatbot-quick-actions" id="quickActions">
                <button class="quick-action" data-action="precios">Precios</button>
                <button class="quick-action" data-action="paquetes">Paquetes</button>
                <button class="quick-action" data-action="ayuda">Ayuda</button>
            </div>
            <form class="chatbot-input" id="chatbotForm">
                <input type="text" id="chatInput" placeholder="Escribe tu mensaje..." autocomplete="off">
                <button type="submit"><i class="fas fa-paper-plane"></i></button>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="../js/data/locales.js"></script>
    <script src="../js/data/servicios.js"></script>
    <script src="../js/utils/helpers.js"></script>
    <script src="../js/components/header.js"></script>
    <script src="../js/components/chatbot.js"></script>
    <script src="../js/components/auth.js"></script>
    <script src="../js/components/toast.js"></script>
    <script src="../js/components/user.js"></script>
    <script src="../js/components/calendar.js"></script>
    <script src="../js/components/reservations.js"></script>
    <script src="../js/app.js"></script>

    <script>
        let currentService = null;

        document.addEventListener('DOMContentLoaded', () => {
            loadService();
            initNav();
        });

        function loadService() {
            const urlParams = new URLSearchParams(window.location.search);
            const slug = urlParams.get('slug');

            if (!slug) {
                window.location.href = 'servicios.html';
                return;
            }

            currentService = SERVICIOS_DATA.find(s => s.slug === slug);

            if (!currentService) {
                window.location.href = 'servicios.html';
                return;
            }

            renderService();
        }

        function renderService() {
            const s = currentService;

            // Update page title
            document.title = `${s.name} | Cel√©bralo pe`;

            // Render Gallery
            renderGallery();

            // Badges are now inside the gallery
            // (removed old badges rendering)

            // Category
            const category = SERVICE_CATEGORIES[s.category] || { name: s.category, icon: 'üéâ' };
            document.querySelector('#serviceCategory .emoji').textContent = category.icon;
            document.querySelector('#serviceCategory .name').textContent = category.name;

            // Basic info
            document.getElementById('serviceName').textContent = s.name;
            document.getElementById('serviceDescription').textContent = s.description;

            // Rating
            const ratingContainer = document.getElementById('serviceRating');
            ratingContainer.querySelector('.score').textContent = s.rating;
            ratingContainer.querySelector('.reviews').textContent = `(${s.reviewsCount} rese√±as)`;

            // Price
            const basePrice = s.pricing.basePrice || (s.pricing.packages && s.pricing.packages[0].price) || 0;
            document.getElementById('bookingPrice').textContent = `S/ ${basePrice.toLocaleString()}`;
            document.getElementById('bookingUnit').textContent = s.pricing.type === 'per-person' ? '/persona' : '/servicio';

            // Owner
            if (s.owner) {
                document.getElementById('ownerAvatar').textContent = s.owner.avatar;
                document.getElementById('ownerName').textContent = s.owner.name;
                document.getElementById('ownerBusiness').textContent = s.name;
                document.getElementById('ownerRate').textContent = `${s.owner.responseRate}%`;
                document.getElementById('ownerTime').textContent = s.owner.responseTime;
            }

            // Features
            const featuresHtml = s.features.map(feature => `
                <div class="feature-item">
                    <div class="feature-icon">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="feature-text">${feature}</div>
                </div>
            `).join('');
            document.getElementById('featuresGrid').innerHTML = featuresHtml;

            // Packages
            if (s.pricing.packages) {
                const packagesHtml = s.pricing.packages.map((pkg, index) => `
                    <div class="package-card ${index === 1 ? 'recommended' : ''}">
                        <div class="package-name">${pkg.name}</div>
                        <div class="package-price">S/ ${pkg.price.toLocaleString()}${pkg.hours ? ` <small>(${pkg.hours}h)</small>` : ''}</div>
                        <div class="package-description">${pkg.description}</div>
                    </div>
                `).join('');
                document.getElementById('packagesGrid').innerHTML = packagesHtml;
            }

            // Coverage
            const coverageHtml = s.location.coverage.map(city =>
                `<span class="coverage-tag"><i class="fas fa-map-marker-alt" style="margin-right: 4px;"></i>${city}</span>`
            ).join('');
            document.getElementById('coverageList').innerHTML = coverageHtml;

            // Availability
            renderAvailability(s);

            // Policies
            renderPolicies(s);

            // Reviews
            renderReviews(s);

            // Initialize Calendar
            initCalendar(s);

            // Track recently viewed
            if (window.userManager) {
                userManager.addToRecentlyViewed({
                    id: s.id,
                    slug: s.slug,
                    name: s.name,
                    icon: s.icon,
                    rating: s.rating,
                    price: s.pricing.basePrice
                }, 'servicios');
            }
        }

        function renderAvailability(s) {
            const days = [
                { key: 'monday', name: 'Lun' },
                { key: 'tuesday', name: 'Mar' },
                { key: 'wednesday', name: 'Mie' },
                { key: 'thursday', name: 'Jue' },
                { key: 'friday', name: 'Vie' },
                { key: 'saturday', name: 'Sab' },
                { key: 'sunday', name: 'Dom' }
            ];

            if (!s.availability) return;

            const html = days.map(day => {
                const avail = s.availability[day.key];
                const isAvailable = avail && avail.available;
                return `
                    <div class="availability-day ${isAvailable ? 'available' : 'unavailable'}">
                        <div class="day-name">${day.name}</div>
                        <div class="day-hours">${isAvailable ? avail.hours : 'Cerrado'}</div>
                    </div>
                `;
            }).join('');

            document.getElementById('availabilityGrid').innerHTML = html;
            document.getElementById('advanceBooking').textContent = s.availability.advanceBooking || '3 dias';
        }

        function renderPolicies(s) {
            if (!s.policies) {
                document.getElementById('policiesSection').style.display = 'none';
                return;
            }

            // Cancellation
            if (s.policies.cancellation) {
                document.querySelector('#policyCancellation p').textContent = s.policies.cancellation;
            }

            // Deposit
            if (s.policies.deposit) {
                document.querySelector('#policyDeposit p').textContent = s.policies.deposit;
            }

            // Rules
            if (s.policies.rules && s.policies.rules.length > 0) {
                const rulesHtml = s.policies.rules.map(rule =>
                    `<span class="rule"><i class="fas fa-check"></i>${rule}</span>`
                ).join('');
                document.getElementById('policyRules').innerHTML = rulesHtml;
            }
        }

        function renderReviews(s) {
            const reviews = s.reviews || [];

            // Summary
            document.getElementById('avgRating').textContent = s.rating || '0';
            document.getElementById('totalReviews').textContent = `${s.reviewsCount || reviews.length} resenas`;

            // Stars
            const fullStars = Math.floor(s.rating || 0);
            const hasHalf = (s.rating || 0) % 1 >= 0.5;
            let starsHtml = '';
            for (let i = 0; i < fullStars; i++) {
                starsHtml += '<i class="fas fa-star"></i>';
            }
            if (hasHalf) starsHtml += '<i class="fas fa-star-half-alt"></i>';
            document.getElementById('scoreStars').innerHTML = starsHtml;

            // Reviews list
            if (reviews.length === 0) {
                document.getElementById('reviewsList').style.display = 'none';
                document.getElementById('reviewsEmpty').style.display = 'block';
                return;
            }

            const reviewsHtml = reviews.map(review => `
                <div class="review-card">
                    <div class="review-header">
                        <div class="review-avatar">${review.userAvatar}</div>
                        <div class="review-info">
                            <strong>
                                ${review.userName}
                                ${review.verified ? '<span class="verified-badge"><i class="fas fa-check-circle"></i></span>' : ''}
                            </strong>
                            <div class="review-meta">
                                <span class="review-stars">${'<i class="fas fa-star"></i>'.repeat(review.rating)}</span>
                                <span>${formatReviewDate(review.date)}</span>
                            </div>
                        </div>
                    </div>
                    <p class="review-text">${review.comment}</p>
                    <div class="review-footer">
                        <span class="review-event">
                            <i class="fas fa-tag"></i>
                            ${review.eventType}
                        </span>
                        <span class="review-helpful">
                            <i class="fas fa-thumbs-up"></i>
                            ${review.helpful || 0} util
                        </span>
                    </div>
                </div>
            `).join('');

            document.getElementById('reviewsList').innerHTML = reviewsHtml;
        }

        function formatReviewDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('es-PE', { year: 'numeric', month: 'long' });
        }

        function renderGallery() {
            const gallery = document.getElementById('serviceGallery');
            const s = currentService;
            const images = s.images || [];
            const mainImage = images[0] || null;
            const thumb1 = images[1] || null;
            const thumb2 = images[2] || null;
            const extraCount = Math.max(0, images.length - 3);

            const category = SERVICE_CATEGORIES[s.category] || { name: s.category, icon: 'üéâ' };
            const badgesHtml = s.badges.map(badge =>
                `<span class="service-badge ${badge.toLowerCase().includes('verificado') ? 'verified' : ''}">${badge}</span>`
            ).join('');

            gallery.innerHTML = `
                <div class="gallery-main">
                    ${mainImage
                        ? `<img src="${mainImage}" alt="${s.name}" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                           <div class="placeholder" style="display:none;">${category.icon}</div>`
                        : `<div class="placeholder">${category.icon}</div>`
                    }
                    <div class="service-badges">${badgesHtml}</div>
                </div>
                <div class="gallery-side">
                    <div class="gallery-thumb">
                        ${thumb1
                            ? `<img src="${thumb1}" alt="${s.name}" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                               <div class="placeholder" style="display:none;">üéâ</div>`
                            : `<div class="placeholder">üéâ</div>`
                        }
                    </div>
                    <div class="gallery-thumb">
                        ${thumb2
                            ? `<img src="${thumb2}" alt="${s.name}" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                               <div class="placeholder" style="display:none;">‚ú®</div>`
                            : `<div class="placeholder">‚ú®</div>`
                        }
                        ${extraCount > 0 ? `<div class="gallery-more">+${extraCount} fotos</div>` : ''}
                    </div>
                </div>
            `;
        }

        let serviceCalendar = null;
        let selectedDate = null;

        function initCalendar(s) {
            if (!s.availability) return;

            serviceCalendar = new EventCalendar('#bookingCalendar', {
                availability: s.availability,
                blockedDates: s.blockedDates || [],
                showLegend: true,
                onDateSelect: (date, dateStr) => {
                    selectedDate = dateStr;
                    document.getElementById('bookingSelection').style.display = 'block';
                    document.getElementById('selectedDateText').textContent = formatSelectedDate(date);
                    document.getElementById('btnReservar').disabled = false;
                    document.getElementById('contactDate').value = dateStr;
                }
            });
        }

        function formatSelectedDate(date) {
            return date.toLocaleDateString('es-PE', {
                weekday: 'long',
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        function initNav() {
            const navToggle = document.getElementById('navToggle');
            const navMenu = document.getElementById('navMenu');

            if (navToggle && navMenu) {
                navToggle.addEventListener('click', () => {
                    navMenu.classList.toggle('active');
                });
            }
        }

        function openContactModal() {
            document.getElementById('contactModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeContactModal() {
            document.getElementById('contactModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function contactOwner() {
            // Abrir chat en modo propietario
            if (window.eventBot && window.eventBot.currentOwner) {
                window.eventBot.switchToOwnerMode();
            } else if (window.eventBot) {
                window.eventBot.open();
                showToast('info', 'Contacto', `Para consultas sobre "${currentService.name}", usa nuestro chat.`);
            }
        }

        function submitContact(e) {
            e.preventDefault();

            const formData = {
                clienteNombre: document.getElementById('contactName').value,
                clienteTelefono: document.getElementById('contactPhone').value,
                clienteEmail: document.getElementById('contactEmail').value,
                tipoEvento: document.getElementById('contactEvent').value,
                fechaEvento: document.getElementById('contactDate').value || selectedDate,
                clienteMensaje: document.getElementById('contactMessage').value,
                providerName: currentService.name,
                providerId: currentService.id,
                providerSlug: currentService.slug,
                providerIcon: currentService.icon,
                tipo: 'servicio',
                paquete: null,
                precioBase: currentService.pricing.basePrice || 0,
                precioEstimado: currentService.pricing.basePrice || 0
            };

            // Crear reserva usando el manager
            if (window.reservationManager) {
                const reservation = reservationManager.createReservation(formData);
                reservationManager.syncToGoogleSheets(reservation);
            }

            // Enviar a Google Sheets si esta disponible
            if (typeof sendToGoogleSheets === 'function') {
                sendToGoogleSheets('Cotizaciones', {
                    id: 'COT-' + Date.now(),
                    nombre: formData.clienteNombre,
                    telefono: formData.clienteTelefono,
                    email: formData.clienteEmail,
                    tipoEvento: formData.tipoEvento,
                    fecha: formData.fechaEvento,
                    mensaje: formData.clienteMensaje,
                    servicio: currentService.name,
                    tipo: 'servicio',
                    fechaCreacion: new Date().toLocaleDateString('es-PE'),
                    timestamp: new Date().toISOString()
                });
            }

            showToast('success', 'Reserva enviada', 'Tu solicitud ha sido registrada. Te contactaremos pronto.');
            closeContactModal();
            document.getElementById('contactForm').reset();

            // Reset calendar selection
            if (serviceCalendar) {
                serviceCalendar.clearSelection();
            }
            document.getElementById('bookingSelection').style.display = 'none';
            document.getElementById('btnReservar').disabled = true;
            selectedDate = null;
        }

        function showToast(type, title, message) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : 'info-circle'}"></i>
                </div>
                <div class="toast-content">
                    <strong>${title}</strong>
                    <p>${message}</p>
                </div>
            `;
            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('show');
            }, 100);

            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // Close modal on click outside
        document.getElementById('contactModal').addEventListener('click', (e) => {
            if (e.target.id === 'contactModal') {
                closeContactModal();
            }
        });

        // ==========================================
        // FUNCIONES DE FAVORITOS Y COMPARTIR
        // ==========================================

        function shareService() {
            const title = currentService?.name || 'Servicio';
            const text = currentService?.shortDescription || 'Mira este servicio en Cel√©bralo pe';
            const url = window.location.href;

            if (navigator.share) {
                navigator.share({ title, text, url })
                    .then(() => showToast('success', 'Compartido', 'Enlace compartido correctamente'))
                    .catch(err => console.log('Error al compartir:', err));
            } else {
                // Fallback: copiar al portapapeles
                navigator.clipboard.writeText(url)
                    .then(() => showToast('success', 'Enlace copiado', 'El enlace ha sido copiado al portapapeles'))
                    .catch(() => showToast('error', 'Error', 'No se pudo copiar el enlace'));
            }
        }

        function toggleFavoriteService() {
            const btn = document.getElementById('favBtn');
            const icon = btn.querySelector('i');

            // Usar userManager para guardar correctamente en el historial
            if (window.userManager && currentService) {
                const isFavorite = userManager.toggleFavorite(currentService.id, 'servicios');

                if (isFavorite) {
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    btn.style.color = 'var(--error)';
                    showToast('success', '‚ù§Ô∏è Guardado', 'Agregado a tus favoritos');

                    // Registrar en Google Sheets
                    if (typeof sendToGoogleSheets === 'function') {
                        sendToGoogleSheets('Feedback', {
                            tipo: 'favorito_agregado',
                            mensaje: `Servicio: ${currentService.name}`,
                            servicioId: currentService.id,
                            servicioSlug: currentService.slug,
                            fecha: new Date().toLocaleDateString('es-PE')
                        });
                    }
                } else {
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    btn.style.color = '';
                    showToast('info', 'Eliminado', 'Eliminado de favoritos');
                }
            } else {
                // Fallback si userManager no est√° disponible
                const isFavorite = icon.classList.contains('fas');
                if (isFavorite) {
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    btn.style.color = '';
                    showToast('info', 'Eliminado', 'Eliminado de favoritos');
                } else {
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    btn.style.color = 'var(--error)';
                    showToast('success', '‚ù§Ô∏è Guardado', 'Agregado a favoritos');
                }
            }
        }

        // Actualizar estado del bot√≥n de favoritos al cargar
        function updateFavoriteButton() {
            if (window.userManager && currentService) {
                const btn = document.getElementById('favBtn');
                const icon = btn?.querySelector('i');
                if (icon && userManager.isFavorite(currentService.id, 'servicios')) {
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    btn.style.color = 'var(--error)';
                }
            }
        }

        // Llamar a updateFavoriteButton despu√©s de cargar el servicio
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => updateFavoriteButton(), 500);
        });

        // ==========================================
        // SISTEMA DE RESE√ëAS
        // ==========================================

        const REVIEWS_STORAGE_KEY = 'celebralo_service_reviews';
        let selectedRating = 0;

        function openReviewModal() {
            // Verificar si el usuario est√° logueado
            const user = window.userManager?.getUserData();
            if (user) {
                document.getElementById('reviewName').value = user.name || '';
                document.getElementById('reviewEmail').value = user.email || '';
            }

            if (currentService) {
                document.getElementById('reviewModalSubtitle').textContent = `Comparte tu experiencia con ${currentService.name}`;
            }
            document.getElementById('reviewModal').classList.add('active');
            document.body.style.overflow = 'hidden';

            // Inicializar estrellas
            initStarRating();
        }

        function closeReviewModal() {
            document.getElementById('reviewModal').classList.remove('active');
            document.body.style.overflow = '';
            selectedRating = 0;
            document.getElementById('reviewForm').reset();
            updateStarDisplay(0);
        }

        function initStarRating() {
            const stars = document.querySelectorAll('#starRatingInput i');
            stars.forEach(star => {
                star.onclick = function() {
                    selectedRating = parseInt(this.dataset.rating);
                    document.getElementById('reviewRating').value = selectedRating;
                    updateStarDisplay(selectedRating);
                };

                star.onmouseenter = function() {
                    const rating = parseInt(this.dataset.rating);
                    updateStarDisplay(rating);
                };
            });

            document.getElementById('starRatingInput').onmouseleave = function() {
                updateStarDisplay(selectedRating);
            };
        }

        function updateStarDisplay(rating) {
            const stars = document.querySelectorAll('#starRatingInput i');
            stars.forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('far');
                    star.classList.add('fas');
                    star.style.color = 'var(--warning)';
                } else {
                    star.classList.remove('fas');
                    star.classList.add('far');
                    star.style.color = 'var(--gray-300)';
                }
            });
        }

        async function submitReview(e) {
            e.preventDefault();

            if (selectedRating === 0) {
                showToast('warning', 'Calificacion requerida', 'Por favor selecciona una calificacion con las estrellas');
                return;
            }

            const btn = document.getElementById('submitReviewBtn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
            btn.disabled = true;

            const review = {
                id: 'REV-' + Date.now(),
                serviceId: currentService?.id,
                serviceName: currentService?.name,
                rating: selectedRating,
                eventType: document.getElementById('reviewEventType').value,
                comment: document.getElementById('reviewComment').value,
                userName: document.getElementById('reviewName').value,
                userEmail: document.getElementById('reviewEmail').value,
                userAvatar: document.getElementById('reviewName').value.charAt(0).toUpperCase(),
                date: new Date().toISOString(),
                verified: false
            };

            try {
                // Guardar localmente
                saveServiceReview(review);

                // Enviar a Google Sheets
                if (typeof sendToGoogleSheets === 'function') {
                    await sendToGoogleSheets('Feedback', {
                        id: review.id,
                        tipo: 'resena_servicio',
                        servicio: currentService?.name,
                        servicioId: currentService?.id,
                        calificacion: review.rating,
                        tipoEvento: review.eventType,
                        mensaje: review.comment,
                        nombre: review.userName,
                        email: review.userEmail,
                        fecha: new Date().toLocaleDateString('es-PE'),
                        timestamp: new Date().toISOString()
                    });
                }

                closeReviewModal();
                showToast('success', 'Gracias por tu resena!', 'Tu opinion ayuda a otros usuarios');

                // Recargar rese√±as
                loadServiceReviews();

            } catch (error) {
                console.error('Error al enviar resena:', error);
                showToast('error', 'Error', 'No se pudo enviar la resena. Intenta de nuevo.');
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        function saveServiceReview(review) {
            const allReviews = JSON.parse(localStorage.getItem(REVIEWS_STORAGE_KEY) || '{}');
            const serviceId = review.serviceId || 'unknown';
            if (!allReviews[serviceId]) {
                allReviews[serviceId] = [];
            }
            allReviews[serviceId].unshift(review);
            localStorage.setItem(REVIEWS_STORAGE_KEY, JSON.stringify(allReviews));
        }

        function loadServiceReviews() {
            if (!currentService) return;

            const allReviews = JSON.parse(localStorage.getItem(REVIEWS_STORAGE_KEY) || '{}');
            const userReviews = allReviews[currentService.id] || [];
            const existingReviews = currentService.reviews || [];
            const combinedReviews = [...userReviews, ...existingReviews];

            if (combinedReviews.length > 0) {
                document.getElementById('reviewsList').style.display = 'block';
                document.getElementById('reviewsEmpty').style.display = 'none';

                const reviewsHtml = combinedReviews.map(review => `
                    <div class="review-item" style="padding: 16px; border: 1px solid var(--border-light); border-radius: 12px; margin-bottom: 12px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <div style="width: 40px; height: 40px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                                    ${review.userAvatar || review.userName?.charAt(0) || 'U'}
                                </div>
                                <div>
                                    <strong>${review.userName}</strong>
                                    ${review.id?.startsWith('REV-') ? '<span style="color: var(--primary); font-size: 12px;"> (Tu resena)</span>' : ''}
                                    <div style="font-size: 12px; color: var(--text-muted);">${review.eventType || 'Evento'}</div>
                                </div>
                            </div>
                            <div style="color: var(--warning);">
                                ${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5 - review.rating)}
                            </div>
                        </div>
                        <p style="color: var(--text-secondary); margin: 0;">${review.comment}</p>
                    </div>
                `).join('');

                document.getElementById('reviewsList').innerHTML = reviewsHtml;

                // Actualizar promedio
                const avgRating = (combinedReviews.reduce((sum, r) => sum + r.rating, 0) / combinedReviews.length).toFixed(1);
                document.getElementById('avgRating').textContent = avgRating;
                document.getElementById('totalReviews').textContent = `${combinedReviews.length} resenas`;
            }
        }

        // Cargar rese√±as al iniciar
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => loadServiceReviews(), 600);
        });

        // Cerrar modal con click fuera
        document.getElementById('reviewModal')?.addEventListener('click', (e) => {
            if (e.target.id === 'reviewModal') {
                closeReviewModal();
            }
        });
    </script>
</body>
</html>
